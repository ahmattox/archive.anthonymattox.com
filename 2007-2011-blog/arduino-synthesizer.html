

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Arduino Synthesizer || Anthony Mattox - Interaction Design & Digital Art</title>
	<link type="text/css" rel="stylesheet" href="wp-content/themes/p10/style.css" />
	
	<!-- feeds -->
    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="feed" />
    <link rel="alternate" type="text/xml" title="RSS .92" href="feed/rss" />
    <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="feed/atom" />
    <link rel="pingback" href="xmlrpc.php" />
	<link rel="icon" type="image/png" href="wp-content/themes/p10/favicon.png" />
	
		<!-- post specific styles -->
		<style>
		body{
			background:;
		}
	</style>
			<!-- / styles -->
	
			
<!-- processing embed scripts -->
<script src="wp-content/plugins/wordpress-processing-embed/data/pe_deployJava.js"></script>

				
	<script type="text/javascript">//<![CDATA[
	// Google Analytics for WordPress by Yoast v4.0.12 | http://yoast.com/wordpress/google-analytics/
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount','UA-6086323-1']);
</script><script src="wp-content/plugins/google-analytics-for-wordpress/custom_se_async.js" type="text/javascript"></script>
<script type="text/javascript">	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
	//]]></script>
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js?ver=2.2'></script>
<script type='text/javascript' src='http://anthonymattox.com/wp-includes/js/jquery/jquery.js?ver=1.7.2'></script>

<script type="text/javascript" charset="utf-8">

	/**
	 * Courtesy of Kimili Flash Embed - Version 2.1.5
	 * by Michael Bester - http://kimili.com
	 */

	(function(){
		try {
			// Disabling SWFObject's Autohide feature
			if (typeof swfobject.switchOffAutoHideShow === "function") {
				swfobject.switchOffAutoHideShow();
			}
		} catch(e) {}
	})();
</script>
<link rel='prev' title='Robot Fest' href='index.html%3Fp=1240.html' />
<link rel='next' title='Summertime' href='index.html%3Fp=1286.html' />
<link rel='canonical' href='index.html%3Fp=1264.html' />
<link rel='shortlink' href='index.html%3Fp=1264.html' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[303,361] -->
<meta name="description" content="I've been interested in experimenting with electronic music for a while now and also recently started doing some work with the Arduino. So I thought, 'why not" />
<meta name="keywords" content="arduino,audio,dac,processing,sound,synthesizer,art,article" />
<!-- /all in one seo pack -->
<script type="text/javascript" src="wp-content/plugins/audio-player/assets/audio-player.js%3Fver=2.0.4.1"></script>
<script type="text/javascript">AudioPlayer.setup("http://anthonymattox.com/wp-content/plugins/audio-player/assets/player.swf?ver=2.0.4.1", {width:"100%",animation:"no",encode:"yes",initialvolume:"60",remaining:"no",noinfo:"no",buffer:"5",checkpolicy:"no",rtl:"no",bg:"333333",text:"ffffff",leftbg:"333333",lefticon:"a3a3a3",volslider:"ffffff",voltrack:"525252",rightbg:"d9d9d9",rightbghover:"FF2200",righticon:"333333",righticonhover:"FFFFFF",track:"000000",loader:"FF2200",border:"000000",tracker:"666666",skip:"666666",pagebg:"FFFFFF",transparentpagebg:"yes"});</script>
    	<link rel='archives' title='October 2011' href='2011/10.html' />
	<link rel='archives' title='September 2011' href='2011/09.html' />
	<link rel='archives' title='July 2011' href='2011/07.html' />
	<link rel='archives' title='June 2011' href='2011/06.html' />
	<link rel='archives' title='May 2011' href='2011/05.html' />
	<link rel='archives' title='January 2011' href='2011/01.html' />
	<link rel='archives' title='December 2010' href='2010/12.html' />
	<link rel='archives' title='November 2010' href='2010/11.html' />
	<link rel='archives' title='October 2010' href='2010/10.html' />
	<link rel='archives' title='September 2010' href='2010/09.html' />
	<link rel='archives' title='June 2010' href='2010/06.html' />
	<link rel='archives' title='May 2010' href='2010/05.html' />
	<link rel='archives' title='April 2010' href='2010/04.html' />
	<link rel='archives' title='March 2010' href='2010/03.html' />
	<link rel='archives' title='February 2010' href='2010/02.html' />
	<link rel='archives' title='January 2010' href='2010/01.html' />
	<link rel='archives' title='December 2009' href='2009/12.html' />
	<link rel='archives' title='November 2009' href='2009/11.html' />
	<link rel='archives' title='October 2009' href='2009/10.html' />
	<link rel='archives' title='September 2009' href='2009/09.html' />
	<link rel='archives' title='August 2009' href='2009/08.html' />
	<link rel='archives' title='May 2009' href='2009/05.html' />
	<link rel='archives' title='April 2009' href='2009/04.html' />
	<link rel='archives' title='March 2009' href='2009/03.html' />
	<link rel='archives' title='February 2009' href='2009/02/index.html' />
	<link rel='archives' title='January 2009' href='2009/01/index.html' />
	<link rel='archives' title='December 2008' href='2008/12/index.html' />
	<link rel='archives' title='November 2008' href='2008/11/index.html' />
	<link rel='archives' title='October 2008' href='2008/10.html' />
	<link rel='archives' title='June 2008' href='2008/06.html' />
	<link rel='archives' title='August 2007' href='2007/08.html' />
	<link rel='archives' title='June 2007' href='2007/06.html' />
	
	<!-- <script type="text/javascript" language="javascript1.5" src="http://anthonymattox.com/wp-content/themes/p10/scripts/jquery-ui-1.8.5.custom.min.js"></script>-->
	<script type="text/javascript" language="javascript1.5" src="wp-content/themes/p10/scripts/jquery.fancybox-1.3.1.pack.js"></script>
	<script type="text/javascript" language="javascript1.5" src="wp-content/themes/p10/scripts/jquery.ui.effects.js"></script>
	<script type="text/javascript" language="javascript1.5" src="wp-content/themes/p10/scripts/am_p10.js"></script>
</head>
<body>
	<div id="container" class="blog">
		<div id="head">
			<div id="mainhead">
				<h1><a href="index.html">Anthony Mattox <span>Interaction Design + Digital Art</span></a></h1>
				<ul id="nav">
					<li class="page_item page-item-27"><a href="index.html"><span>Home</span></a></li>
<li class="page_item page-item-746"><a href="work/index.html"><span>Work</span></a></li>
<li class="page_item page-item-398 current_page_parent"><a href="blog/index.html"><span>Blog</span></a></li>
<li class="page_item page-item-2"><a href="about.html"><span>About</span></a></li>
				</ul>
			</div>
			
						
					</div><div class="body" id="single">
	<div class="neck">
	</div>
		<div class="post">
		<div class="meta">
		  <div class="metacontent">
  			<h2><a href="index.html%3Fp=1264.html">Arduino Synthesizer</a></h2>
  			<div>
  				<p class="date">05-06-09</p>
  				<p class="tags">Tagged: <a href="tag/arduino.html" rel="tag">arduino</a>, <a href="tag/audio.html" rel="tag">audio</a>, <a href="tag/dac.html" rel="tag">dac</a>, <a href="tag/processing/index.html" rel="tag">processing</a>, <a href="tag/sound/index.html" rel="tag">sound</a>, <a href="tag/synthesizer.html" rel="tag">synthesizer</a><br /></p>
  				  			</div>
  						</div>
		</div>
		<div class="content">
			<p>I&#8217;ve been interested in experimenting with electronic music for a while now and also recently started doing some work with the <a href="http://www.arduino.cc" target="_blank">Arduino</a>. So I thought, &#8216;why not try both?&#8217; I began with a <a href="http://blog.makezine.com/archive/2008/05/makeit_protodac_shield_fo.html" target="_blank">great article</a> I found on <a href="http://www.makezine.com/" target="_blank">Make Magazine</a> (one of my absolute favorite sites) to create the basic script to generate an audio signal with an <a href="http://www.arduino.cc" target="_blank">Arduino</a>. A Digital to Analog Converter (DAC) converts the binary outputs from the <a href="http://www.arduino.cc" target="_blank">Arduino</a> into a relatively fluid scale of voltages which make up the sound wave</p>
<p>On the electronics side, my setup is quite similar to my <a href="http://blog.makezine.com/archive/2008/05/makeit_protodac_shield_fo.html" target="_blank">reference</a>, with the addition of a small amplifier using an LM386 op amp chip and a couple resistors and capacitors for some basic filtering. On the code side I&#8217;ve created a much more substantial instrument. Using <a href="http://www.processing.org" target="_blank">Processing</a> I built an interface to create a 32 sample waveform and a melody. The data is sent live to the <a href="http://www.arduino.cc" target="_blank">Arduino</a> which places the data into it&#8217;s waveform array and then using a timer writes each value sequentially to the DAC to create the sound.</p>
<div class="img"><a href="http://www.anthonymattox.com/wp-content/uploads/2009/05/arduino_synthesizer_dac.jpg" class="thickbox"><img src="http://www.anthonymattox.com/wp-content/uploads/2009/05/arduino_synthesizer_dac-450x290.jpg" alt="arduino_synthesizer_dac" title="arduino_synthesizer_dac" width="450" height="290" class="alignnone size-medium wp-image-1422" /></a><small></small></div>
<p>The interface contains two sets of sliders. One represents the shape of the sound wave. Changing the shape alters the timbre of the sound. The second set controls a series of pitches. The currently playing note is lit and a light bar indicates the current position of the playhead. The waveform sliders can be adjusted individually or as a group by clicking and dragging across the set. The sequence bars control both the pitch and the frequency of the notes.</p>
<div class="img"><a href="http://www.anthonymattox.com/wp-content/uploads/2009/05/arduino_synthesizer_interface.gif" class="thickbox"><img src="http://www.anthonymattox.com/wp-content/uploads/2009/05/arduino_synthesizer_interface-450x300.gif" alt="arduino_synthesizer_interface" title="arduino_synthesizer_interface" width="450" height="300" class="alignnone size-medium wp-image-1421" /></a><small></small></div>
<p><span id="more-1264"></span></p>
<h3>A Video</h3>
<p><object width="450" height="304"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="http://vimeo.com/moogaloop.swf?clip_id=4516622&amp;server=vimeo.com&amp;show_title=0&amp;show_byline=0&amp;show_portrait=0&amp;color=04d2d8&amp;fullscreen=1" /><embed src="http://vimeo.com/moogaloop.swf?clip_id=4516622&amp;server=vimeo.com&amp;show_title=0&amp;show_byline=0&amp;show_portrait=0&amp;color=04d2d8&amp;fullscreen=1" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="450" height="304"></embed></object></p>
<h3>Technical Stuff</h3>
<p>On the <a href="http://www.arduino.cc" target="_blank">Arduino</a> side an array of characters (buff[]) stores incoming serial data from <a href="http://www.processing.org" target="_blank">Processing</a> through the USB cable. Two more arrays store the current wave form and sequence data. Using the avr timer the script writes the next sample in the waveform to pins 1-8 thirty-two times for one period of the current frequency. All variables from <a href="http://www.processing.org" target="_blank">Processing</a> are stored in the buffer. If the <a href="http://www.arduino.cc" target="_blank">Arduino</a> receives and indicator character ( &#8216;A&#8217; or &#8216;B&#8217; ) it will then process the previously received data accordingly and write it into the appropriate array.</p>
<p>Rather than continually sending the full pitch sequence, <a href="http://www.processing.org" target="_blank">Processing</a> sends only the current frequency which is passed into a variable used by the timer. The frequency is derived directly from the position of the current pitch slider, as an integer between 0 and 255. To improve the sound this should be mapped the set of standardized musical notes either using an array of predetermined pitches or, more elegantly, with some fancy math. The pitches are currently quite arbitrary.</p>
<p>For more details on building the Digital to analog converter look at <a href="http://blog.makezine.com/archive/2008/05/makeit_protodac_shield_fo.html" target="_blank">this documentation</a>. The setup is fairly simple and just involves a bunch of resistors, some wire, and a speaker. They include a potentiometer to change the pitch. If your controlling it with <a href="http://www.processing.org" target="_blank">Processing</a> this isn&#8217;t necessary. I also left out the jack and plugged an old speaker directly into my breadboard.</p>
<div class="code arduino">
<h4 class="cHead"><span><a href="http://www.arduino.cc">arduino</a> code<br /><a href="http://www.anthonymattox.com/code_formatter">code formatter</a></span>Arduino Synthesizer</h4>
<pre><span Class="COM">// arduino synthesizer code
</span><span Class="COM">// requires waveform and frequency data from processing
</span>
#include &lt;avr/interrupt.h&gt;
#include &lt;stdlib.h&gt; 

<span Class="KEY">int</span>  i ;
<span Class="KEY">int</span> potval;

<span Class="KEY">char</span> buff[]= <span Class="STR">&quot;000000000000000000000000000000000000&quot;</span>;
<span Class="KEY">char</span> Mel[]= <span Class="STR">&quot;000000&quot;</span>;
<span Class="KEY">char</span> wave [32]; 

<span Class="KEY">void</span> ioinit (<span Class="KEY">void</span>) {
   <span Class="COM">//Initialize output ports
</span>   PORTD = B11111111;
   DDRD  = B11111111;
} 

<span Class="KEY">void</span> timer_setup(){
  TCCR2A = 0;
  TCNT2=455;    <span Class="COM">//455 outputs 1.007khz
</span>  TCCR2B = B00000010;
  <span Class="COM">//Timer2 Overflow Interrupt Enable
</span>  TIMSK2 = 1&lt;&lt;TOIE2;
}

<span Class="KEY">void</span> <span Class="KEY">setup</span>(){
  ioinit();
  <span Class="KEY">for</span> (<span Class="KEY">int</span> i=0; i&lt;32; i++) {
    wave[i]=0;
  }
  cli();
  timer_setup();
  i = 0;
  sei();

  <span Class="KEY">Serial</span>.begin(9600);
}

ISR(TIMER2_OVF_vect) {
  PORTD=(wave[i++]);
  TCNT2=potval;
  <span Class="KEY">if</span>(i==32){
    i=0;
  }
} 

<span Class="KEY">void</span> <span Class="KEY">loop</span>() {
  <span Class="COM">// gathers data sent from processing
</span>  <span Class="KEY">while</span>(<span Class="KEY">Serial</span>.available()&gt;0) {
    <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;36; i++) {
      buff[i]=buff[i+1];
    }
    buff[36]=<span Class="KEY">Serial</span>.read();
    <span Class="COM">// <span Class="KEY">if</span> an indicator <span Class="KEY">char</span> is found
</span>    <span Class="COM">// the data is processed
</span>    <span Class="KEY">if</span> (buff[36]==<span Class="STR">'A'</span>) {
      <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;32; i++) {
        wave[i]=buff[35-i];
      }
    } <span Class="KEY">else</span>
    <span Class="KEY">if</span> (buff[36]==<span Class="STR">'B'</span>) {
      potval=buff[35];
    }
  }
}</pre>
</div>
<h3><a href="http://www.processing.org" target="_blank">Processing</a> stuff</h3>
<p>The <a href="http://www.processing.org" target="_blank">Processing</a> code is quite a bit longer, but is, I think, a little easier to digest. I commented key lines with their purpose but will also give a quick overview. If you would like to play with the interface without an <a href="http://www.arduino.cc" target="_blank">Arduino</a> plugged it it will give you an error. To remedy this comment out the lines regarding the serial functions. These code chunks are marked with &#8220;//**.&#8221; You will also need to include your own font file.</p>
<p>The sliders are created with the same class (more or less) I&#8217;ve used in a few <a href="http://www.anthonymattox.com/serial-communication-sending-variables-to-the-arduino">other projects</a>. These are stored in an array and handled in the draw loop. The sequencer sliders use an extended slider class which adds new graphics a few variables to handle the duration of each note. They are handled by the &#8216;set&#8217; class which includes the functions to change the length of notes on right click. The set stores the clicked slider in a variable, in order to handle any adjustments, until the mouse is released. The set also includes the playhead which slides across the sequence. The note it is currently over is stored to be sent to the <a href="http://www.arduino.cc" target="_blank">Arduino</a>.</p>
<p>A few key improvements could be made. The data sent to the <a href="http://www.arduino.cc" target="_blank">Arduino</a> only really needs to be sent at the start of the program and then when changes are made or when the playhead reaches the next note in the sequence. The <a href="http://www.arduino.cc" target="_blank">Arduino</a> script should already handle this change.</p>
<div class="code processing">
<h4 class="cHead"><span><a href="http://www.processing.org">processing</a> code<br /><a href="http://www.anthonymattox.com/code_formatter">code formatter</a></span>Arduino Synth Interface (processing)</h4>
<pre><span Class="COM">// arduino synth interface
</span><span Class="COM">// anthony mattox www.anthonymattox.com
</span>
<span Class="KEY">import</span> processing.serial.*;
Serial port;

slider[] Wave=<span Class="KEY">new</span> slider[32];
Set melBars;
<span Class="KEY">void</span> <span Class="KEY">setup</span>() {
  <span Class="KEY">size</span>(1200,800);
  <span Class="KEY">noStroke</span>();
  <span Class="KEY">noFill</span>();
  <span Class="KEY">smooth</span>();
  <span Class="COM">// create waveform sliders
</span>  <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;Wave.length; i++) {
    Wave[i]=<span Class="KEY">new</span> slider(i*31+125, 100, 255, <span Class="KEY"><span Class="KEY">color</span></span>(0));
  }
  <span Class="COM">// create instance of sequencer <span Class="KEY">set</span>, parameter is # of notes
</span>  melBars=<span Class="KEY">new</span> Set(17);

  <span Class="KEY">PFont</span> font;
  <span Class="COM">// hooray Gotham, you'll need to add your own font file
</span>  <span Class="COM">//   tools&gt;create font, add your file name below
</span>  font = <span Class="KEY">loadFont</span>(<span Class="STR">&quot;Gotham-Light-30.vlw&quot;</span>);
  <span Class="KEY">textFont</span>(font); 

  <span Class="COM">//** <span Class="KEY">set</span> up serial port
</span>  <span Class="KEY">println</span>(<span Class="STR">&quot;Available serial ports:&quot;</span>);
  <span Class="KEY">println</span>(Serial.list());
  port = <span Class="KEY">new</span> Serial(<span Class="KEY">this</span>, Serial.list()[0], 9600);
}

<span Class="KEY">void</span> <span Class="KEY">draw</span>() {
  <span Class="KEY">background</span>(255);
  <span Class="COM">// start with some graphics
</span>  <span Class="KEY">pushStyle</span>();
  <span Class="KEY">fill</span>(229);
  <span Class="KEY">noStroke</span>();
  <span Class="KEY">rect</span>(0,0,1200,55);
  <span Class="KEY">rect</span>(0,790,1200,10);

  <span Class="KEY">noFill</span>();
  <span Class="KEY">stroke</span>(150);
  <span Class="KEY">strokeWeight</span>(1);
  <span Class="KEY">line</span>(25,228,1089,228);
  <span Class="KEY">line</span>(25,710,1089,710);

  <span Class="KEY">fill</span>(0);
  <span Class="KEY">textSize</span>(14);
  <span Class="KEY">text</span>(<span Class="STR">&quot;waveform&quot;</span>, 25, 225);
  <span Class="KEY">textSize</span>(14);
  <span Class="KEY">text</span>(<span Class="STR">&quot;sequence&quot;</span>, 25, 707);
  <span Class="KEY">textSize</span>(22);
  <span Class="KEY">text</span>(<span Class="STR">&quot;arduino sythesizer&quot;</span>, 25, 35);
  <span Class="KEY">textAlign</span>(<span Class="STR">RIGHT</span>);
  <span Class="KEY">textSize</span>(14);
  <span Class="KEY">text</span>(<span Class="STR">&quot;anthony mattox&quot;</span>, 1185, 25);
  <span Class="KEY">text</span>(<span Class="STR">&quot;www.anthonymattox.com&quot;</span>, 1185, 42);
  <span Class="KEY">popStyle</span>();

  <span Class="COM">// update+render waveform sliders
</span>  <span Class="COM">// <span Class="KEY">this</span> could all be put into a slider <span Class="KEY">set</span> <span Class="KEY">class</span>
</span>  <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;Wave.length; i++) {
    Wave[i].update();
    Wave[i].render();
    <span Class="KEY">if</span> (i&gt;0) {
      <span Class="KEY">pushStyle</span>();
      <span Class="KEY">noFill</span>();
      <span Class="KEY">stroke</span>(0);
      <span Class="KEY">strokeWeight</span>(2);
      <span Class="KEY">line</span>(Wave[i].xpos, Wave[i].thesize-Wave[i].p+Wave[i].ypos,
           Wave[i-1].xpos, Wave[i-1].thesize-Wave[i-1].p+Wave[i-1].ypos);
      <span Class="KEY">popStyle</span>();
    }
  }
  <span Class="COM">// update+render sequencer <span Class="KEY">set</span>
</span>  melBars.update();
  melBars.render();
  <span Class="COM">//** write data to serial
</span>  Write();
}

<span Class="COM">//**
</span><span Class="KEY">void</span> Write() {
  <span Class="COM">// writes all slider values followed by indicator
</span>  <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;Wave.length; i++) {
    port.write(Wave[i].p);
  }
  port.write(<span Class="STR">'A'</span>);
  port.write(melBars.current.p);
  port.write(<span Class="STR">'B'</span>);
}

<span Class="COM">// Slider Class
</span><span Class="KEY">class</span> slider {
  <span Class="KEY">int</span> xpos, ypos, thesize, p;
  <span Class="KEY">boolean</span> slide;
  <span Class="KEY"><span Class="KEY">color</span></span> c, cb;
  slider (<span Class="KEY">int</span> x, <span Class="KEY">int</span> y, <span Class="KEY">int</span> s, <span Class="KEY"><span Class="KEY">color</span></span> col) {
    xpos=x;
    ypos=y;
    thesize=s;
    p=127;
    slide=<span Class="KEY">false</span>;
    c=col;
    <span Class="COM">//cb=<span Class="KEY"><span Class="KEY">color</span></span>(<span Class="KEY">red</span>(c),<span Class="KEY">green</span>(c),<span Class="KEY">blue</span>(c),150);
</span>    cb=<span Class="KEY"><span Class="KEY">color</span></span>(0,211,216,150);
  }

  <span Class="KEY">void</span> render() {
    <span Class="KEY">stroke</span>(0,35);
    <span Class="KEY">strokeWeight</span>(10);
    <span Class="KEY">noFill</span>();
    <span Class="KEY">line</span>(xpos,ypos,xpos,ypos+thesize);

    <span Class="KEY">stroke</span>(80);
    <span Class="KEY">strokeWeight</span>(1.5);
    <span Class="KEY">noFill</span>();
    <span Class="KEY">line</span>(xpos,ypos,xpos,ypos+thesize);

    <span Class="KEY">noStroke</span>();
    <span Class="KEY">fill</span>(cb);
    <span Class="KEY">ellipse</span>(xpos, thesize-p+ypos, 12, 12);
    <span Class="KEY">fill</span>(c);
    <span Class="KEY">ellipse</span>(xpos, thesize-p+ypos, 8, 8);
  }

  <span Class="KEY">void</span> update() {
    <span Class="KEY">if</span> (slide=<span Class="KEY">true</span> &#038;&#038; <span Class="KEY">mousePressed</span>==<span Class="KEY">true</span> &#038;&#038; <span Class="KEY">mouseButton</span>==<span Class="STR">LEFT</span>
         &#038;&#038; <span Class="KEY">mouseX</span>&lt;xpos+13 &#038;&#038; <span Class="KEY">mouseX</span>&gt;xpos-13){
      <span Class="KEY">if</span> ((<span Class="KEY">mouseY</span>&lt;=ypos+thesize+10) &#038;&#038; (<span Class="KEY">mouseY</span>&gt;=ypos-10)) {
        p=thesize-(<span Class="KEY">mouseY</span>-ypos);
        <span Class="KEY">if</span> (p&lt;0) {
          p=0;
        } <span Class="KEY">else</span> <span Class="KEY">if</span> (p&gt;thesize) {
          p=thesize;
        }
      }
    }
  }
}

<span Class="COM">// sequencer bar <span Class="KEY">class</span>
</span><span Class="COM">// similar to <span Class="KEY">normal</span> slider <span Class="KEY">class</span> but with different rendering
</span><span Class="COM">// must be within a <span Class="STR">'<span Class="KEY">set</span>'</span> <span Class="KEY">for</span> all functions
</span>
<span Class="KEY">class</span> bar <span Class="KEY">extends</span> slider{
  <span Class="KEY">int</span> w;
  bar (<span Class="KEY">int</span> x, <span Class="KEY">int</span> y, <span Class="KEY">int</span> s, <span Class="KEY"><span Class="KEY">color</span></span> col) {
    <span Class="KEY">super</span>(x, y, s, col);
    w=25;
    p=0;
  }

  <span Class="KEY">void</span> render() {
    <span Class="KEY">if</span> (melBars.current==<span Class="KEY">this</span>){
      <span Class="KEY">noStroke</span>();
      <span Class="KEY">fill</span>(0,211,216);
      <span Class="KEY">rect</span>(xpos,ypos-5, w, thesize+10);
    }

    <span Class="KEY">noFill</span>();
    <span Class="KEY">stroke</span>(0);
    <span Class="KEY">line</span>(xpos,ypos-5,xpos,ypos+thesize+5);

    <span Class="KEY">fill</span>(0);
    <span Class="KEY">rect</span>(xpos,thesize-p+ypos-5,w,10);
  }

  <span Class="KEY">void</span> update() {
    <span Class="KEY">if</span> (melBars.Target==<span Class="KEY">null</span> &#038;&#038; melBars.wTarget==<span Class="KEY">null</span>) {
      <span Class="KEY">if</span> (<span Class="KEY">mousePressed</span>==<span Class="KEY">true</span> &#038;&#038; <span Class="KEY">mouseX</span>&lt;xpos+w &#038;&#038; <span Class="KEY">mouseX</span>&gt;xpos
          &#038;&#038; (<span Class="KEY">mouseY</span>&lt;=ypos+thesize+10) &#038;&#038; (<span Class="KEY">mouseY</span>&gt;=ypos-10)){
        <span Class="KEY">if</span> (<span Class="KEY">mouseButton</span>==<span Class="STR">LEFT</span>) {
          melBars.Target=<span Class="KEY">this</span>;
        } <span Class="KEY">else</span>
        <span Class="KEY">if</span> (<span Class="KEY">mouseButton</span>==<span Class="STR">RIGHT</span>) {
          melBars.wTarget=<span Class="KEY">this</span>;
        }
      }
    }
  }
}

<span Class="COM">// sequencer <span Class="KEY">class</span>
</span>
<span Class="KEY">class</span> Set{
  bar[] Mel;
  bar wTarget;
  bar Target;
  <span Class="KEY">int</span> ind;
  <span Class="KEY">int</span> theHeight;
  <span Class="KEY">int</span> ypos;
  bar current;

  Set(<span Class="KEY">int</span> N) {
    Mel=<span Class="KEY">new</span> bar[N];
    theHeight=255;
    ypos=450;
    <span Class="COM">// create sliders
</span>    <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;Mel.length; i++) {
      Mel[i]=<span Class="KEY">new</span> bar(i*25+125, ypos, theHeight, <span Class="KEY"><span Class="KEY">color</span></span>(i*(255/Mel.length),0,200));
    }
    <span Class="COM">// variables <span Class="KEY">for</span> active sliders
</span>    wTarget=<span Class="KEY">null</span>;
    Target=<span Class="KEY">null</span>;
    current=Mel[0];
    ind=100;
  }

  <span Class="KEY">void</span> render() {
    <span Class="COM">// W stores <span Class="STR">width</span> of the <span Class="KEY">set</span>
</span>    <span Class="KEY">int</span> W=tWidth();
    <span Class="COM">// some graphics
</span>    <span Class="KEY">noFill</span>();
    <span Class="KEY">stroke</span>(0);
    <span Class="KEY">line</span>(W+125,Mel[0].ypos-5,W+125,Mel[0].ypos+Mel[0].thesize+5);

    <span Class="KEY">pushStyle</span>();
    <span Class="KEY">stroke</span>(150);
    <span Class="KEY">strokeWeight</span>(1);
    <span Class="KEY">line</span>(125,ypos-6,125+W,ypos-6);
    <span Class="KEY">popStyle</span>();

    <span Class="COM">// playhead to light and send current frequency to arduino
</span>    ind+=2;
    <span Class="KEY">if</span> (ind&gt;W+125) {
      ind=125;
    }

    <span Class="KEY">pushStyle</span>();
    <span Class="KEY">strokeCap</span>(SQUARE);
    <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;Mel.length; i++) {
      Mel[i].render();
      <span Class="KEY">if</span> (ind&gt;Mel[i].xpos &#038;&#038; ind&lt;Mel[i].xpos+Mel[i].w){
        current=Mel[i];
      }
    }
    <span Class="KEY">popStyle</span>();

    <span Class="KEY">noStroke</span>();
    <span Class="KEY">fill</span>(255,200);
    <span Class="KEY">rect</span>(ind, ypos-5, 3, theHeight+10);
  }

  <span Class="KEY">void</span> update() {
    <span Class="COM">// some interaction stuff
</span>    <span Class="KEY">if</span> (<span Class="KEY">mousePressed</span>){
      <span Class="KEY">if</span> (Target!=<span Class="KEY">null</span>) {
        Target.p=Target.thesize-(<span Class="KEY">mouseY</span>-Target.ypos);
        <span Class="KEY">if</span> (Target.p&lt;0) {
          Target.p=0;
        } <span Class="KEY">else</span> <span Class="KEY">if</span> (Target.p&gt;Target.thesize) {
          Target.p=Target.thesize;
        }
      } <span Class="KEY">else</span>
      <span Class="KEY">if</span> (wTarget!=<span Class="KEY">null</span>) {
        wTarget.w=<span Class="KEY">mouseX</span>-wTarget.xpos;
        <span Class="KEY">if</span> (wTarget.w&lt;25){
          wTarget.w=25;
        }
      }

      <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;Mel.length; i++) {
        Mel[i].update();
        <span Class="KEY">if</span> (i&gt;0) {
          Mel[i].xpos=Mel[i-1].xpos + Mel[i-1].w;
        }
      }

    }
  }

  <span Class="KEY">int</span> tWidth() {
    <span Class="KEY">int</span> q=0;
    <span Class="KEY">for</span>(<span Class="KEY">int</span> i=0; i&lt;Mel.length; i++) {
      q+=Mel[i].w;
    }
    <span Class="KEY">return</span> q;
  }

}

<span Class="COM">// some mousey things
</span>
<span Class="KEY">void</span> <span Class="KEY">mouseReleased</span>() {
  melBars.wTarget=<span Class="KEY">null</span>;
  melBars.Target=<span Class="KEY">null</span>;
}

<span Class="KEY">void</span> <span Class="KEY">mousePressed</span>() {
  <span Class="KEY">if</span> (<span Class="KEY">mouseX</span>&gt;980 &#038;&#038; <span Class="KEY">mouseY</span>&lt;55) {
    <span Class="KEY">link</span>(<span Class="STR">&quot;http:<span Class="COM">//www.anthonymattox.com&quot;</span>);
</span>  }
}</pre>
</div>
<p>That was a little long, but I hope you enjoyed it. I know I did. If your trying to run this without an <a href="http://www.arduino.cc" target="_blank">Arduino</a> connected be sure to check out my note above about removing the communication code.</p>
<p>If you have any questions, comments, or resolutions leave a comment. Other people may have the same issues.</p>
		</div>
				<br class="clear" />
	</div>
		
	<div id="comments">
		
			<h3><span>6 comments</span></h3>
		
				
		<ul id="commentlist">
				<li class="comment even thread-even depth-1">
		<div class="commentmeta">
			<h5><a href="index.html%3Fp=1264.html">noman</a></h5>
			<div class="date">05.07.09</div>
			<div class="reply">
							</div>
		</div>

		<div class="commentbody">
						<p>I think audio to visuals is more interesting than vice versa, due to the fact that visuals have to be extremely simplified to produce a pleasant sound.<br />
And then there is the fact that -correct me if I&#8217;m wrong- there already are a ton of plugins for this functionality.</p>
		</div>
		<br class="clear" />

	</li>
	<li class="comment odd alt thread-odd thread-alt depth-1">
		<div class="commentmeta">
			<h5><a href="index.html%3Fp=1264.html">noman</a></h5>
			<div class="date">05.07.09</div>
			<div class="reply">
							</div>
		</div>

		<div class="commentbody">
						<p>Nonetheless a cool setup, though.</p>
		</div>
		<br class="clear" />

	</li>
	<li class="post pingback">
		<p>Pingback: <a href='http://daily.ocular-witness.com/?p=2670' rel='external nofollow' class='url'>Arduino synth/sequencer with Processing + R2R DAC - machine quotidien</a></p>
	</li>
	<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1">
		<div class="commentmeta">
			<h5><a href="http://www.anthonymattox.com">tony</a></h5>
			<div class="date">05.07.09</div>
			<div class="reply">
							</div>
		</div>

		<div class="commentbody">
						<p>That&#8217;s true. There are a lot of plugins that do similar things but the audio quality isn&#8217;t good enough for anything serious. This was just a fun experiment. I also tried to create a more intuitive interface that some other programs.</p>
		</div>
		<br class="clear" />

	</li>
	<li class="comment odd alt thread-odd thread-alt depth-1">
		<div class="commentmeta">
			<h5><a href="index.html%3Fp=1264.html">noman</a></h5>
			<div class="date">05.07.09</div>
			<div class="reply">
							</div>
		</div>

		<div class="commentbody">
						<p>Kind of hateful to see lines of code about audio, when I want to learn about your particle system, haha.<br />
It&#8217;s all good, though.</p>
		</div>
		<br class="clear" />

	</li>
	<li class="post pingback">
		<p>Pingback: <a href='http://dev.squarecows.com/2009/05/07/arduino-synthsequencer-with-processing-r2r-dac/' rel='external nofollow' class='url'>Arduino synth/sequencer with Processing + R2R DAC | SquareCows</a></p>
	</li>
		</ul>
		
			
	</div>	</div>
    <div id="foot">
      <div id="footcontent">
        <div id="cc">
          <a href="http://creativecommons.org/licenses/by-nc/3.0/"></a>
        </div>
        <div id="links">
          <a href="http://twitter.com/ahmattox" id="foot-twitter">@ahmattox</a>
          <a href="http://friendsoftheweb.com/" id="foot-ftw">Friends of The Web</a>
          <a href="http://madewithloveinbaltimore.org" id="foot-heart">Made with &hearts; in Baltimore</a>
        </div>
        <br class="clear" />
      </div>
    </div>
  </div><!-- / container -->
  </body>
</html>